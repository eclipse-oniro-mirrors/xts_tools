/*
 * Copyright (c) 2025 Shenzhen Kaihong Digital Industry Development Co., Ltd.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

@Entry
@Component
struct UIComponentListAndGridGridEventEnhancement05 {
  @State scrollIndexCount: number = 0;
  @State statusMessage: string = 'ç­‰å¾…æ“ä½œ';
  @State statusColor: Color = Color.Grey;
  @State eventLogs: string[] = [];
  @State currentScrollPosition: string = 'é¡¶éƒ¨';
  @State firstIndex: number = 0;
  @State lastIndex: number = 0;
  private dataSource: number[] = [];
  private scroller: Scroller = new Scroller();

  aboutToAppear(): void {
    console.info('Index: Grid onScrollIndex æµ‹è¯•é¡µé¢åŠ è½½');
    // åˆå§‹åŒ–æ•°æ®æºï¼š1 åˆ° 100ï¼ˆè¶³å¤Ÿå¤šçš„æ•°æ®ä»¥ä¾¿æ»šåŠ¨ï¼‰
    for (let i = 1; i <= 20; i++) {
      this.dataSource.push(i);
    }
  }

  addLog(message: string) {
    const timestamp = new Date().toLocaleTimeString();
    const logMessage = `[${timestamp}] ${message}`;
    this.eventLogs.unshift(logMessage);
    if (this.eventLogs.length > 10) {
      this.eventLogs.pop();
    }
    console.info(logMessage);
  }

  build() {
    Column({ space: 4 }) {
      Column({ space: 2 }) {
        Text('Grid onScrollIndex äº‹ä»¶æµ‹è¯•')
          .fontSize(13)
          .fontWeight(FontWeight.Bold)
          .fontColor('#182431')

        Text('SUB_ACE_UI_COMPONENT_LISTANDGRID_GRID_EVENTENHANCEMENT_0300_438')
          .fontSize(7)
          .fontColor('#99182431')
          .fontFamily('Courier')

        Divider().strokeWidth(1).color('#E5E5E5')
      }
      .width('100%')
      .padding(4)
      .backgroundColor('#FAFAFA')

      Scroll() {
        Column({ space: 4 }) {
          // æµ‹è¯•è¯´æ˜
          Column({ space: 2 }) {
            Text('âœ¦ æµ‹è¯•åœºæ™¯')
              .fontSize(10)
              .fontWeight(FontWeight.Medium)
              .fontColor('#182431')
              .width('100%')

            Text('éªŒè¯æ‰‹åŠ¿æ»‘åŠ¨ç»„ä»¶è§¦å‘onScrollIndexäº‹ä»¶')
              .fontSize(8)
              .fontColor('#666666')
              .width('100%')
              .lineHeight(12)
              .padding(3)
              .backgroundColor('#FFF8E1')
              .borderRadius(3)
              .border({ width: 1, color: '#FFE082' })
          }
          .width('96%')
          .alignItems(HorizontalAlign.Start)

          // çŠ¶æ€æ˜¾ç¤º
          Column({ space: 2 }) {
            Text('âœ¦ å½“å‰çŠ¶æ€')
              .fontSize(10)
              .fontWeight(FontWeight.Medium)
              .fontColor('#182431')
              .width('100%')

            Row({ space: 6 }) {
              Column({ space: 1 }) {
                Text('å½“å‰ä½ç½®')
                  .fontSize(8)
                  .fontColor('#666666')
                Text(this.currentScrollPosition)
                  .fontSize(11)
                  .fontWeight(FontWeight.Bold)
                  .fontColor('#007DFF')
              }

              Column({ space: 1 }) {
                Text('ç´¢å¼•è§¦å‘')
                  .fontSize(8)
                  .fontColor('#666666')
                Text(`${this.scrollIndexCount}`)
                  .fontSize(11)
                  .fontWeight(FontWeight.Bold)
                  .fontColor(this.scrollIndexCount > 0 ? '#FF6B6B' : '#999999')
              }

              Column({ space: 1 }) {
                Text('é¦–é¡¹ç´¢å¼•')
                  .fontSize(8)
                  .fontColor('#666666')
                Text(`${this.firstIndex}`)
                  .fontSize(11)
                  .fontWeight(FontWeight.Bold)
                  .fontColor('#4CAF50')
              }

              Column({ space: 1 }) {
                Text('å°¾é¡¹ç´¢å¼•')
                  .fontSize(8)
                  .fontColor('#666666')
                Text(`${this.lastIndex}`)
                  .fontSize(11)
                  .fontWeight(FontWeight.Bold)
                  .fontColor('#9C27B0')
              }
            }
            .width('100%')
            .padding(5)
            .backgroundColor('#E3F2FD')
            .borderRadius(3)
            .justifyContent(FlexAlign.SpaceAround)

            Text(this.statusMessage)
              .fontSize(8)
              .fontWeight(FontWeight.Bold)
              .fontColor(this.statusColor)
              .width('100%')
              .padding(4)
              .backgroundColor('#F5F5F5')
              .borderRadius(3)
              .border({ width: 1, color: '#E0E0E0' })
          }
          .width('96%')
          .alignItems(HorizontalAlign.Start)

          // Grid å±•ç¤ºåŒº
          Column({ space: 2 }) {
            Text('âœ¦ Grid ç»„ä»¶å±•ç¤ºï¼ˆ100é¡¹æ•°æ®ï¼‰')
              .fontSize(10)
              .fontWeight(FontWeight.Medium)
              .fontColor('#182431')
              .width('100%')

            Text('ğŸ‘‰ è¯·ç”¨æ‰‹æŒ‡æ»‘åŠ¨ Grid ç»„ä»¶')
              .fontSize(8)
              .fontColor('#FF6D00')
              .fontWeight(FontWeight.Bold)
              .width('100%')

            // Grid ç»„ä»¶
            Grid(this.scroller) {
              ForEach(this.dataSource, (item: number) => {
                GridItem() {
                  Text(`${item}`)
                    .fontSize(12)
                    .fontWeight(FontWeight.Medium)
                    .fontColor('#FFFFFF')
                    .width('100%')
                    .height('100%')
                    .textAlign(TextAlign.Center)
                    .backgroundColor(item % 2 === 0 ? '#4CAF50' : '#2196F3')
                    .borderRadius(4)
                }
                .width('100%')
                .height(45)
              }, (item: number) => item.toString())
            }
            .id('UIComponentListAndGridGridEventEnhancement05')
            .columnsTemplate('1fr 1fr 1fr')
            .columnsGap(6)
            .rowsGap(6)
            .width('100%')
            .height(250)
            .backgroundColor('#F0F0F0')
            .borderRadius(4)
            .border({ width: 2, color: '#FF6B6B', style: BorderStyle.Solid })
            .onScrollIndex((first: number, last: number) => {
              this.scrollIndexCount++;
              this.firstIndex = first;
              this.lastIndex = last;
              this.statusMessage = `âœ“ onScrollIndex è§¦å‘ï¼é¦–é¡¹: ${first}, å°¾é¡¹: ${last}`;
              this.statusColor = Color.Red;
              this.addLog(`âœ“ onScrollIndex è§¦å‘ (ç¬¬ ${this.scrollIndexCount} æ¬¡, é¦–é¡¹: ${first}, å°¾é¡¹: ${last})`);
            })
            .onScrollFrameBegin((offset: number) => {
              // ç›‘æ§æ»šåŠ¨æ–¹å‘
              if (offset < 0) {
                this.currentScrollPosition = 'å‘ä¸Šæ»šåŠ¨...';
              } else if (offset > 0) {
                this.currentScrollPosition = 'å‘ä¸‹æ»šåŠ¨...';
              }
              return { offsetRemain: offset };
            })
          }
          .width('96%')
          .alignItems(HorizontalAlign.Start)

          // æ“ä½œæŒ‰é’®åŒº
          Column({ space: 3 }) {
            Text('âœ¦ æ“ä½œæŒ‰é’®')
              .fontSize(10)
              .fontWeight(FontWeight.Medium)
              .fontColor('#182431')
              .width('100%')

            Row({ space: 5 }) {
              Button('æ»šåˆ°é¡¶éƒ¨')
                .id('Index_01')
                .fontSize(9)
                .layoutWeight(1)
                .height(32)
                .backgroundColor('#00BCD4')
                .fontColor('#FFFFFF')
                .borderRadius(4)
                .onClick(() => {
                  console.info('Grid: ç‚¹å‡»æ»šåŠ¨åˆ°é¡¶éƒ¨æŒ‰é’®');
                  this.scroller.scrollEdge(Edge.Top);
                  this.statusMessage = 'âœ“ æ»šåŠ¨åˆ°é¡¶éƒ¨';
                  this.statusColor = Color.Blue;
                  this.addLog('ç¼–ç¨‹å¼æ»šåŠ¨åˆ°é¡¶éƒ¨');
                })

              Button('æ»šåˆ°åº•éƒ¨')
                .id('Index_02')
                .fontSize(9)
                .layoutWeight(1)
                .height(32)
                .backgroundColor('#FF5722')
                .fontColor('#FFFFFF')
                .borderRadius(4)
                .onClick(() => {
                  console.info('Grid: ç‚¹å‡»æ»šåŠ¨åˆ°åº•éƒ¨æŒ‰é’®');
                  this.scroller.scrollEdge(Edge.Bottom);
                  this.statusMessage = 'âœ“ æ»šåŠ¨åˆ°åº•éƒ¨';
                  this.statusColor = Color.Orange;
                  this.addLog('ç¼–ç¨‹å¼æ»šåŠ¨åˆ°åº•éƒ¨');
                })
            }
            .width('100%')

            Button('æ¸…é™¤æ—¥å¿—')
              .id('Index_03')
              .fontSize(9)
              .width('100%')
              .height(28)
              .backgroundColor('#607D8B')
              .fontColor('#FFFFFF')
              .borderRadius(4)
              .onClick(() => {
                console.info('Grid: ç‚¹å‡»æ¸…é™¤æ—¥å¿—æŒ‰é’®');
                this.scrollIndexCount = 0;
                this.firstIndex = 0;
                this.lastIndex = 0;
                this.eventLogs = [];
                this.currentScrollPosition = 'é¡¶éƒ¨';
                this.statusMessage = 'å·²æ¸…é™¤æ‰€æœ‰æ—¥å¿—';
                this.statusColor = Color.Grey;
              })
          }
          .width('96%')
          .alignItems(HorizontalAlign.Start)

          // äº‹ä»¶æ—¥å¿—
          Column({ space: 2 }) {
            Text('âœ¦ äº‹ä»¶æ—¥å¿—ï¼ˆæœ€è¿‘10æ¡ï¼‰')
              .fontSize(10)
              .fontWeight(FontWeight.Medium)
              .fontColor('#182431')
              .width('100%')

            if (this.eventLogs.length > 0) {
              Column({ space: 1 }) {
                ForEach(this.eventLogs, (log: string, index: number) => {
                  Text(log)
                    .fontSize(7)
                    .fontColor(log.includes('onScrollIndex') ? '#FF6B6B' : '#666666')
                    .fontFamily('Courier')
                    .width('100%')
                    .padding(2)
                    .backgroundColor(index % 2 === 0 ? '#F5F5F5' : '#FFFFFF')
                }, (log: string, index: number) => `${index}_${log}`)
              }
              .width('100%')
              .backgroundColor('#FAFAFA')
              .borderRadius(3)
              .border({ width: 1, color: '#E0E0E0' })
            } else {
              Text('æš‚æ— æ—¥å¿—')
                .fontSize(8)
                .fontColor('#999999')
                .width('100%')
                .textAlign(TextAlign.Center)
                .padding(6)
                .backgroundColor('#FAFAFA')
                .borderRadius(3)
                .border({ width: 1, color: '#E0E0E0' })
            }
          }
          .width('96%')
          .alignItems(HorizontalAlign.Start)

          // æ“ä½œæ­¥éª¤
          Column({ space: 2 }) {
            Text('âœ¦ æ“ä½œæ­¥éª¤')
              .fontSize(10)
              .fontWeight(FontWeight.Medium)
              .fontColor('#182431')
              .width('100%')

            Column({ space: 1 }) {
              Text('ã€æ‰‹åŠ¿æ»šåŠ¨æ–¹å¼ã€‘')
                .fontSize(8)
                .fontColor('#FF6D00')
                .fontWeight(FontWeight.Bold)
                .width('100%')
              Text('1. æ‰‹æŒ‡åœ¨ Grid ä¸Šæ»‘åŠ¨ï¼ˆå‘ä¸Šæˆ–å‘ä¸‹å‡å¯ï¼‰')
                .fontSize(8)
                .fontColor('#666666')
                .width('100%')
              Text('2. è§‚å¯Ÿ onScrollIndex äº‹ä»¶è§¦å‘')
                .fontSize(8)
                .fontColor('#666666')
                .width('100%')
              Text('3. æŸ¥çœ‹é¦–é¡¹å’Œå°¾é¡¹ç´¢å¼•å˜åŒ–')
                .fontSize(8)
                .fontColor('#666666')
                .width('100%')
              Text('ã€æŒ‰é’®æ»šåŠ¨æ–¹å¼ã€‘')
                .fontSize(8)
                .fontColor('#00BCD4')
                .fontWeight(FontWeight.Bold)
                .width('100%')
              Text('4. ç‚¹å‡»"æ»šåˆ°åº•éƒ¨"æˆ–"æ»šåˆ°é¡¶éƒ¨"æŒ‰é’®ä¹Ÿä¼šè§¦å‘')
                .fontSize(8)
                .fontColor('#666666')
                .width('100%')
              Text('5. é‡å¤æ­¥éª¤éªŒè¯å¤šæ¬¡è§¦å‘')
                .fontSize(8)
                .fontColor('#666666')
                .width('100%')
            }
            .width('100%')
            .padding(3)
            .backgroundColor('#E3F2FD')
            .borderRadius(3)
            .border({ width: 1, color: '#90CAF9' })
          }
          .width('96%')
          .alignItems(HorizontalAlign.Start)

          // é¢„æœŸç»“æœ
          Column({ space: 2 }) {
            Text('âœ¦ é¢„æœŸç»“æœ')
              .fontSize(10)
              .fontWeight(FontWeight.Medium)
              .fontColor('#182431')
              .width('100%')

            Column({ space: 1 }) {
              Text('â€¢ æ‰‹åŠ¿æ»‘åŠ¨æ—¶è§¦å‘ onScrollIndex')
                .fontSize(8)
                .fontColor('#4CAF50')
                .width('100%')
              Text('â€¢ é¦–é¡¹å’Œå°¾é¡¹ç´¢å¼•å®æ—¶æ›´æ–°æ˜¾ç¤º')
                .fontSize(8)
                .fontColor('#4CAF50')
                .width('100%')
              Text('â€¢ äº‹ä»¶è§¦å‘æ¬¡æ•°æ­£ç¡®ç´¯è®¡')
                .fontSize(8)
                .fontColor('#4CAF50')
                .width('100%')
              Text('â€¢ æ—¥å¿—æ˜¾ç¤ºçº¢è‰²æ ‡è¯† onScrollIndex')
                .fontSize(8)
                .fontColor('#4CAF50')
                .width('100%')
              Text('â€¢ å½“å‰ä½ç½®å®æ—¶æ›´æ–°æ˜¾ç¤º')
                .fontSize(8)
                .fontColor('#4CAF50')
                .width('100%')
              Text('â€¢ æ‰€æœ‰æ“ä½œæ— å´©æºƒæ­£å¸¸å“åº”')
                .fontSize(8)
                .fontColor('#4CAF50')
                .fontWeight(FontWeight.Bold)
                .width('100%')
            }
            .width('100%')
            .padding(3)
            .backgroundColor('#E8F5E9')
            .borderRadius(3)
            .border({ width: 1, color: '#A5D6A7' })
          }
          .width('96%')
          .alignItems(HorizontalAlign.Start)
        }
        .width('100%')
        .padding({ left: 4, right: 4, bottom: 4 })
      }
      .layoutWeight(1)
      .scrollBar(BarState.Auto)

    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F5F5')
  }
}

