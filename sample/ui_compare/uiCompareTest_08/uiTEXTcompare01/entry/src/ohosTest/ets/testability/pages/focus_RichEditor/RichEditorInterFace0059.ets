/**
 * Copyright (c) 2025 Shenzhen Kaihong Digital Industry Development Co., Ltd.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

@Entry
@Component
struct REInterFace0059 {
  controller: RichEditorController = new RichEditorController();
  options: RichEditorOptions = { controller: this.controller };
  @State content: string = "";

  build() {
    Column() {
      // å†…å®¹æ˜¾ç¤ºåŒºåŸŸ
      Column() {
        Text("ç¼–è¾‘å™¨å†…å®¹:").width("100%")
        Text() {
          Span(this.content)
        }.width("100%")
      }
      .border({ width: 1, color: Color.Red })
      .width("100%")
      .padding(10)

      // æ“ä½œæŒ‰é’®
      Button("è·å–å…¨éƒ¨å†…å®¹")
        .id('InterFace0059')
        .onClick(() => this.getAllContent())
        .margin({ top: 20 })

      // å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
      RichEditor(this.options)
        .onReady(() => this.initContent())
        .placeholder("è¾“å…¥å†…å®¹...")
        .border({ width: 1, color: Color.Green })
        .width("100%")
        .height(200)
        .margin({ top: 20 })
    }
    .width("100%")
    .height("100%")
    .padding(20)
  }

  // åˆå§‹åŒ–ç¼–è¾‘å†…å®¹
  private initContent() {
    this.controller.addTextSpan('æµ‹è¯•æ–‡æœ¬ ');
    this.controller.addTextSpan('ğŸ˜„', { style: { fontSize: 24 } }); // Emoji
    this.controller.addSymbolSpan($r("app.media.Symbolspan001")); // ç¬¦å·
    this.controller.addTextSpan(' æ›´å¤šæ–‡æœ¬ ');
    this.controller.addTextSpan('ğŸ‰', { style: { fontSize: 24 } }); // Emoji
  }

  // è·å–å…¨éƒ¨å†…å®¹ï¼ˆä»å¼€å§‹åˆ°ç»“å°¾ï¼‰
  private getAllContent() {
    this.content = "";

    try {
      // è·å–æ•´ä¸ªç¼–è¾‘å™¨çš„Spanä¿¡æ¯ï¼ˆä½¿ç”¨è¶³å¤Ÿå¤§çš„endå€¼ï¼‰
      const spans = this.controller.getSpans({
        start: 0,
        end: 9999  // ä½¿ç”¨ä¸€ä¸ªè¶³å¤Ÿå¤§çš„å€¼ä»£æ›¿getTotalLength
      });

      spans.forEach(item => {
        // ç›´æ¥é€šè¿‡å±æ€§åˆ¤æ–­ç±»å‹
        if (item['imageStyle']) {
          this.content += `[å›¾ç‰‡: ${item['valueResourceStr']}]\n`;
        } else if (item['symbolType']) {
          this.content += `[ç¬¦å·: ${item['symbolType']}]\n`;
        } else {
          this.content += `${item['value'] || 'æœªçŸ¥å†…å®¹'}\n`;
        }
      });
    } catch (error) {
      this.content = `è·å–å†…å®¹å¤±è´¥: ${error.message}`;
    }
  }
}